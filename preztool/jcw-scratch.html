<html>
<head>
<meta charset="UTF-8"/>
<title>J Code Window</title>
<script src="qrc:///qtwebchannel/qwebchannel.js"></script>
<script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>
<style type="text/css">
  html, body {
    margin: 0; padding:0;
    font-family: Calibri; font-size: 28px;
    background:black; color:#fff; }
  h1 { background: gold; color: black; padding: 2px; padding-left:16px; margin:0;}
  pre { font-family: consolas;  padding-left: 16px; margin-top:1ex;}
  /* syntax highlighting for j code */
  .special { color:  limegreen }
  .copula { color: darkcyan; }
  .control { color: tomato; }
  .paren { color: #555; }
  .comment { color: #666; font-style: italic; }
  .float, .integer, .complex, .boolean { color: magenta; }
  .conjunction { color: orangered; }
  .adverb { color: peru; }
  .verb { color: gold; }
  .literal { color: dodgerblue; }
</style>
</head>
<body>
<div id="app">
  <h1>{{head}}</h1>
  <j-code :src="src"></j-code>
</div>
</body>
<script>
// -- vue component to highlight j code -------------
Vue.component('j-code', {
  props: ['src'],
  render: function(h) {
    return h('pre', this.src.map(function(line){
      var toks = line.map(function(tok){
        if(tok[1]===[]) return '';
        return h('span', {'class': tok[0]}, tok[1]);
      });
      toks.push('\n');
      return h('span', toks);
    }));
  }
});

var data = {head:'head goes here', src:'code goes here'},
    app = new Vue({el:"#app", data:data}),
    qcom;

// -- generic j communication driver --------------

/// this makes the connection
/// qt is supplied by "qrc:///qtwebchannel/qwebchannel.js"
new QWebChannel(qt.webChannelTransport, function(channel) {
  qcom = channel.objects.qcom;
  qcom.qNotify.connect(jnotify);
  jpost('init', '');
});


/// this sends a message to j:
function jpost(e,v) { qcom.qPost(['post', e, v]); }
function jerr(s) { jpost('err', s); }

/// this dispatches messages coming *from* j:
function jnotify(s) {
 var f = "j" + s.shift();
 if (window[f] === undefined)
  return jerr("function not found: " + f);
 window[f](s);
}


// -- api exposed to j -----------------------------

function jsrc(x) { data['src'] = JSON.parse(x); }
function jhead(x) { data['head'] = JSON.parse(x); }
function jset(k,v) { data[k] = JSON.stringify(v); }
function jget(k) { jpost('get', [k, data[k]]); }
jsrc(JSON.stringify([[['noun','ok!']]]));

document.body.addEventListener('keypress', function(e) {
  jpost('key', [e.keyCode, 0+e.shiftKey, 0+e.ctrlKey, 0+e.altKey].join(' '));
});

</script>
<script id="scratch">
  let slides = [
[[["name","lines"],["empty"," "],["copula","=:"],["empty"," "],["name","LF"],["empty"," "],["conjunction","&"],["empty"," "],["name","cut"]],[["empty",[]]],[["name","golf"],["empty"," "],["copula","=:"],["empty"," "],["name","lines"],["empty"," "],["paren","("],["boolean","0"],["empty"," "],["conjunction",":"],["empty"," "],["boolean","0"],["paren",")"]],[["name","load"],["empty"," "],["literal","'viewmat'"]],[["verb","f"],["empty"," "],["copula","=:"],["empty"," "],["integer","_1 1"],["empty"," "],["verb","|."],["conjunction","!."],["boolean","0"],["conjunction","\""],["floating","0 _"],["empty"," "],["verb","]"]],[["verb","s"],["empty"," "],["copula","=:"],["empty"," "],["paren","("],["verb","+"],["verb","+"],["adverb","\/"],["conjunction","@"],["paren","("],["integer","_4"],["conjunction","&"],["verb","*"],["verb",","],["verb","f"],["verb",","],["verb","f"],["conjunction","&."],["paren","("],["verb","|:"],["conjunction","\""],["integer","2"],["paren",")"],["paren",")"],["conjunction","@"],["paren","("],["integer","3"],["conjunction","&"],["verb","<"],["paren",")"],["paren",")"],["conjunction","^:"],["floating","_"]],[["name","viewmat"],["empty"," "],["verb","s"],["empty"," "],["integer","50 50"],["empty"," "],["verb","$"],["empty"," "],["integer","4"]],[["paren",")"]],[["empty",[]]],[["name","run"],["empty"," "],["copula","=:"],["empty"," "],["integer","3"],["empty"," "],["conjunction",":"],["empty"," "],["boolean","0"]],[["empty","  "],["comment","NB. this command runs a list of boxed J sentences in sequence"]],[["empty","  "],["control","for_i."],["empty"," "],["verb","i."],["verb","#"],["special","y"],["empty"," "],["control","do."]],[["empty","   "],["name","line"],["empty"," "],["copula","=."],["empty"," "],["verb",">"],["verb","i"],["verb","{"],["special","y"]],[["empty","   "],["name","smoutput"],["empty"," "],["name","line"]],[["empty","   "],["verb","\"."],["empty"," "],["name","line"]],[["empty","  "],["control","end."]],[["paren",")"]],[["name","run"],["empty"," "],["name","golf"]]],

[[["name","settle"],["empty"," "],["copula","=:"],["empty"," "],["name","monad"],["empty"," "],["name","define"],["empty","          "],["comment","NB. settle sandpiles with entries > 3"]],
 [["empty","  "],["name","gt"],["empty"," "],["copula","=."],["empty"," "],["special","y"],["empty"," "],["verb",">"],["empty"," "],["integer","3"]],
 [["empty","  "],["name","up"],["empty"," "],["copula","=."],["empty"," "],["verb","}."],["empty","   "],["name","gt"],["empty"," "],["verb",","],["empty","  "],["boolean","0"],["empty","            "],["comment","NB. shift in each of the 4 directions"]],
 [["empty","  "],["name","dn"],["empty"," "],["copula","=."],["empty"," "],["verb","}:"],["empty","    "],["boolean","0"],["empty"," "],["verb",","],["empty","  "],["name","gt"],["empty","           "],["comment","NB. (filling in with 0 rather than wrapping)"]],
 [["empty","  "],["name","lf"],["empty"," "],["copula","=."],["empty"," "],["verb","}."],["conjunction","\""],["boolean","1"],["empty"," "],["name","gt"],["empty"," "],["verb",",."],["empty"," "],["boolean","0"]],
 [["empty","  "],["name","rt"],["empty"," "],["copula","=."],["empty"," "],["verb","}:"],["conjunction","\""],["boolean","1"],["empty"," "],["verb","]"],["boolean","0"],["empty"," "],["verb",",."],["empty"," "],["name","gt"]],
 [["empty","  "],["name","cn"],["empty"," "],["copula","=."],["empty"," "],["integer","_4"],["empty"," "],["verb","*"],["empty"," "],["name","gt"],["empty","                 "],["comment","NB. the 4 we subtract from the center"]],
 [["empty","  "],["special","y"],["empty"," "],["verb","+"],["empty"," "],["name","up"],["empty"," "],["verb","+"],["empty"," "],["name","dn"],["empty"," "],["verb","+"],["empty"," "],["name","lf"],["empty"," "],["verb","+"],["empty"," "],["name","rt"],["empty"," "],["verb","+"],["empty"," "],["name","cn"]],
 [["paren",")"]],
 [["empty",[]]],
 [["paren","("],["verb","s"],["empty"," "],["verb","-:"],["empty"," "],["name","settle"],["conjunction","^:"],["floating","_"],["paren",")"],["empty"," "],["integer","50 50"],["empty"," "],["verb","$"],["empty"," "],["integer","4"],["empty","      "],["comment","NB. result 1 means the two have the same output."]]],

[[["name","settle1"],["empty"," "],["copula","=:"],["empty"," "],["name","monad"],["empty"," "],["name","define"]],[["empty","  "],["name","gt"],["empty"," "],["copula","=."],["empty"," "],["special","y"],["empty"," "],["verb",">"],["empty"," "],["integer","3"]],[["empty","  "],["name","up"],["empty"," "],["copula","=."],["empty"," "],["name","monad"],["empty"," "],["conjunction",":"],["empty"," "],["literal","'}.   y ,  0 '"],["empty"," "],["name","gt"]],[["empty","  "],["name","dn"],["empty"," "],["copula","=."],["empty"," "],["name","monad"],["empty"," "],["conjunction",":"],["empty"," "],["literal","'}:    0 ,  y'"],["empty"," "],["name","gt"]],[["empty","  "],["name","lf"],["empty"," "],["copula","=."],["empty"," "],["name","monad"],["empty"," "],["conjunction",":"],["empty"," "],["literal","'}.\"1 y ,. 0 '"],["empty"," "],["name","gt"]],[["empty","  "],["name","rt"],["empty"," "],["copula","=."],["empty"," "],["name","monad"],["empty"," "],["conjunction",":"],["empty"," "],["literal","'}:\"1 ]0 ,. y'"],["empty"," "],["name","gt"]],[["empty","  "],["name","cn"],["empty"," "],["copula","=."],["empty"," "],["name","monad"],["empty"," "],["conjunction",":"],["empty"," "],["literal","'_4 * y'"],["empty","       "],["name","gt"]],[["empty","  "],["special","y"],["empty"," "],["verb","+"],["empty"," "],["name","up"],["empty"," "],["verb","+"],["empty"," "],["name","dn"],["empty"," "],["verb","+"],["empty"," "],["name","lf"],["empty"," "],["verb","+"],["empty"," "],["name","rt"],["empty"," "],["verb","+"],["empty"," "],["name","cn"]],[["paren",")"]],[["paren","("],["verb","s"],["empty"," "],["verb","-:"],["empty"," "],["name","settle1"],["conjunction","^:"],["floating","_"],["paren",")"],["empty"," "],["integer","50 50"],["empty"," "],["verb","$"],["empty"," "],["integer","4"],["empty","      "],["comment","NB. result 1 means the two have the same output."]]],
[[["name","settle2"],["empty"," "],["copula","=:"],["empty"," "],["name","monad"],["empty"," "],["name","define"]],[["empty","  "],["name","gt"],["empty"," "],["copula","=."],["empty"," "],["special","y"],["empty"," "],["verb",">"],["empty"," "],["integer","3"]],[["empty","  "],["name","up"],["empty"," "],["copula","=."],["empty"," "],["name","monad"],["empty"," "],["conjunction",":"],["empty"," "],["literal","'}.   y ,  0 '"]],[["empty","  "],["name","dn"],["empty"," "],["copula","=."],["empty"," "],["name","monad"],["empty"," "],["conjunction",":"],["empty"," "],["literal","'}:    0 ,  y'"]],[["empty","  "],["name","lf"],["empty"," "],["copula","=."],["empty"," "],["name","monad"],["empty"," "],["conjunction",":"],["empty"," "],["literal","'}.\"1 y ,. 0 '"]],[["empty","  "],["name","rt"],["empty"," "],["copula","=."],["empty"," "],["name","monad"],["empty"," "],["conjunction",":"],["empty"," "],["literal","'}:\"1 ]0 ,. y'"]],[["empty","  "],["name","cn"],["empty"," "],["copula","=."],["empty"," "],["name","monad"],["empty"," "],["conjunction",":"],["empty"," "],["literal","'_4 * y'"]],[["empty","  "],["special","y"],["empty"," "],["verb","+"],["empty"," "],["paren","("],["name","up"],["empty"," "],["verb","+"],["empty"," "],["name","dn"],["empty"," "],["verb","+"],["empty"," "],["name","lf"],["empty"," "],["verb","+"],["empty"," "],["name","rt"],["empty"," "],["verb","+"],["empty"," "],["name","cn"],["paren",")"],["empty"," "],["name","gt"]],[["paren",")"]],[["paren","("],["verb","s"],["empty"," "],["verb","-:"],["empty"," "],["name","settle2"],["conjunction","^:"],["floating","_"],["paren",")"],["empty"," "],["integer","50 50"],["empty"," "],["verb","$"],["empty"," "],["integer","4"],["empty","      "],["comment","NB. result 1 means the two have the same output."]]],
[[["comment","NB. gt itself is a function of y, and the result is operating on y,"]],[["comment","NB. so we can turn this last line into just a function composition applied to y."]],[["name","settle3"],["empty"," "],["copula","=:"],["empty"," "],["name","monad"],["empty"," "],["name","define"]],[["empty","  "],["name","gt"],["empty"," "],["copula","=."],["empty"," "],["name","monad"],["empty"," "],["conjunction",":"],["empty"," "],["literal","'y > 3'"]],[["empty","  "],["name","up"],["empty"," "],["copula","=."],["empty"," "],["name","monad"],["empty"," "],["conjunction",":"],["empty"," "],["literal","'}.   y ,  0 '"]],[["empty","  "],["name","dn"],["empty"," "],["copula","=."],["empty"," "],["name","monad"],["empty"," "],["conjunction",":"],["empty"," "],["literal","'}:    0 ,  y'"]],[["empty","  "],["name","lf"],["empty"," "],["copula","=."],["empty"," "],["name","monad"],["empty"," "],["conjunction",":"],["empty"," "],["literal","'}.\"1 y ,. 0 '"]],[["empty","  "],["name","rt"],["empty"," "],["copula","=."],["empty"," "],["name","monad"],["empty"," "],["conjunction",":"],["empty"," "],["literal","'}:\"1 ]0 ,. y'"]],[["empty","  "],["name","cn"],["empty"," "],["copula","=."],["empty"," "],["name","monad"],["empty"," "],["conjunction",":"],["empty"," "],["literal","'_4 * y'"]],[["empty","  "],["paren","("],["verb","+"],["empty"," "],["paren","("],["name","up"],["empty"," "],["verb","+"],["empty"," "],["name","dn"],["empty"," "],["verb","+"],["empty"," "],["name","lf"],["empty"," "],["verb","+"],["empty"," "],["name","rt"],["empty"," "],["verb","+"],["empty"," "],["name","cn"],["paren",")"],["conjunction","@"],["name","gt"],["paren",")"],["empty"," "],["special","y"]],[["paren",")"]],[["paren","("],["verb","s"],["empty"," "],["verb","-:"],["empty"," "],["name","settle3"],["conjunction","^:"],["floating","_"],["paren",")"],["empty"," "],["integer","50 50"],["empty"," "],["verb","$"],["empty"," "],["integer","4"],["empty","      "],["comment","NB. result 1 means the two have the same output."]]],
[[["comment","NB. this is actually somewhat longer, but it puts the final expression in tacit form."]],[["comment","NB. which means we could pull all these local definitions"]],[["name","gt"],["empty"," "],["copula","=:"],["empty"," "],["name","monad"],["empty"," "],["conjunction",":"],["empty"," "],["literal","'y > 3'"]],[["name","up"],["empty"," "],["copula","=:"],["empty"," "],["name","monad"],["empty"," "],["conjunction",":"],["empty"," "],["literal","'}.   y ,  0 '"]],[["name","dn"],["empty"," "],["copula","=:"],["empty"," "],["name","monad"],["empty"," "],["conjunction",":"],["empty"," "],["literal","'}:    0 ,  y'"]],[["name","lf"],["empty"," "],["copula","=:"],["empty"," "],["name","monad"],["empty"," "],["conjunction",":"],["empty"," "],["literal","'}.\"1 y ,. 0 '"]],[["name","rt"],["empty"," "],["copula","=:"],["empty"," "],["name","monad"],["empty"," "],["conjunction",":"],["empty"," "],["literal","'}:\"1 ]0 ,. y'"]],[["name","cn"],["empty"," "],["copula","=:"],["empty"," "],["name","monad"],["empty"," "],["conjunction",":"],["empty"," "],["literal","'_4 * y'"]],[["name","settle"],["empty"," "],["copula","=:"],["empty"," "],["name","monad"],["empty"," "],["name","define"]],[["empty","  "],["paren","("],["verb","+"],["empty"," "],["paren","("],["name","up"],["empty"," "],["verb","+"],["empty"," "],["name","dn"],["empty"," "],["verb","+"],["empty"," "],["name","lf"],["empty"," "],["verb","+"],["empty"," "],["name","rt"],["empty"," "],["verb","+"],["empty"," "],["name","cn"],["paren",")"],["conjunction","@"],["name","gt"],["paren",")"],["empty"," "],["special","y"]],[["paren",")"]],[["paren","("],["verb","s"],["empty"," "],["verb","-:"],["empty"," "],["name","settle"],["conjunction","^:"],["floating","_"],["paren",")"],["empty"," "],["integer","50 50"],["empty"," "],["verb","$"],["empty"," "],["integer","4"],["empty","      "],["comment","NB. result 1 means the two have the same output."]]],
[[["comment","NB. and now we can make the final expression tacit, meaning we don't have to"]],[["comment","NB. refer to local variable y, and we're just directly constructing the verb"]],[["comment","NB. out of previously defined verbs."]],[["name","gt"],["empty"," "],["copula","=:"],["empty"," "],["name","monad"],["empty"," "],["conjunction",":"],["empty"," "],["literal","'y > 3'"]],[["name","up"],["empty"," "],["copula","=:"],["empty"," "],["name","monad"],["empty"," "],["conjunction",":"],["empty"," "],["literal","'}.   y ,  0 '"]],[["name","dn"],["empty"," "],["copula","=:"],["empty"," "],["name","monad"],["empty"," "],["conjunction",":"],["empty"," "],["literal","'}:    0 ,  y'"]],[["name","lf"],["empty"," "],["copula","=:"],["empty"," "],["name","monad"],["empty"," "],["conjunction",":"],["empty"," "],["literal","'}.\"1 y ,. 0 '"]],[["name","rt"],["empty"," "],["copula","=:"],["empty"," "],["name","monad"],["empty"," "],["conjunction",":"],["empty"," "],["literal","'}:\"1 ]0 ,. y'"]],[["name","cn"],["empty"," "],["copula","=:"],["empty"," "],["name","monad"],["empty"," "],["conjunction",":"],["empty"," "],["literal","'_4 * y'"]],[["name","settle"],["empty"," "],["copula","=:"],["empty"," "],["verb","+"],["empty"," "],["paren","("],["name","up"],["empty"," "],["verb","+"],["empty"," "],["name","dn"],["empty"," "],["verb","+"],["empty"," "],["name","lf"],["empty"," "],["verb","+"],["empty"," "],["name","rt"],["empty"," "],["verb","+"],["empty"," "],["name","cn"],["paren",")"],["conjunction","@"],["name","gt"]],[["paren","("],["verb","s"],["empty"," "],["verb","-:"],["empty"," "],["name","settle"],["conjunction","^:"],["floating","_"],["paren",")"],["empty"," "],["integer","50 50"],["empty"," "],["verb","$"],["empty"," "],["integer","4"],["empty","      "],["comment","NB. result 1 means the two have the same output."]]],
[[["name","settle"],["empty"," "],["copula","=:"],["empty"," "],["verb","+"],["empty"," "],["paren","("],["name","up"],["empty"," "],["verb","+"],["empty"," "],["name","dn"],["empty"," "],["verb","+"],["empty"," "],["name","lf"],["empty"," "],["verb","+"],["empty"," "],["name","rt"],["empty"," "],["verb","+"],["empty"," "],["name","cn"],["paren",")"],["conjunction","@"],["name","gt"]],[["empty",[]]],[["verb","f"],["empty"," "],["copula","=:"],["empty"," "],["integer","_1 1"],["empty"," "],["verb","|."],["conjunction","!."],["boolean","0"],["conjunction","\""],["floating","0 _"],["empty"," "],["verb","]"]],[["verb","s"],["empty"," "],["copula","=:"],["empty"," "],["paren","("],["verb","+"],["verb","+"],["adverb","\/"],["conjunction","@"],["paren","("],["integer","_4"],["conjunction","&"],["verb","*"],["verb",","],["verb","f"],["verb",","],["verb","f"],["conjunction","&."],["paren","("],["verb","|:"],["conjunction","\""],["integer","2"],["paren",")"],["paren",")"],["conjunction","@"],["paren","("],["integer","3"],["conjunction","&"],["verb","<"],["paren",")"],["paren",")"],["conjunction","^:"],["floating","_"]]],
[[["verb","s"],["empty"," "],["copula","=:"],["empty"," "],["paren","("],["name","s0"],["paren",")"],["conjunction","^:"],["floating","_"]],[["name","s0"],["empty"," "],["copula","=:"],["empty"," "],["verb","+"],["empty"," "],["verb","+"],["adverb","\/"],["conjunction","@"],["paren","("],["integer","_4"],["conjunction","&"],["verb","*"],["verb",","],["verb","f"],["verb",","],["verb","f"],["conjunction","&."],["paren","("],["verb","|:"],["conjunction","\""],["integer","2"],["paren",")"],["paren",")"],["conjunction","@"],["paren","("],["integer","3"],["conjunction","&"],["verb","<"],["paren",")"]]],
[[["name","s0"],["empty"," "],["copula","=:"],["empty"," "],["verb","+"],["empty"," "],["verb","+"],["adverb","\/"],["conjunction","@"],["paren","("],["integer","_4"],["conjunction","&"],["verb","*"],["verb",","],["verb","f"],["verb",","],["verb","f"],["conjunction","&."],["paren","("],["verb","|:"],["conjunction","\""],["integer","2"],["paren",")"],["paren",")"],["conjunction","@"],["paren","("],["integer","3"],["conjunction","&"],["verb","<"],["paren",")"],["empty","    "],["comment","NB. for comparison"]],[["name","s1"],["empty"," "],["copula","=:"],["empty"," "],["verb","+"],["empty","    "],["paren","("],["name","up"],["verb","+"],["name","dn"],["verb","+"],["name","lf"],["verb","+"],["name","rt"],["verb","+"],["name","cn"],["paren",")"],["conjunction","@"],["name","gt"],["empty","         "],["comment","NB. settle"]],[["empty",[]]],[["comment","NB. we can re-arrange the terms a bit to make them line up"]],[["empty",[]]],[["name","s1"],["empty"," "],["copula","=:"],["empty"," "],["verb","+"],["empty","    "],["paren","("],["name","cn"],["verb","+"],["name","up"],["verb","+"],["name","dn"],["verb","+"],["name","lf"],["verb","+"],["name","rt"],["paren",")"],["conjunction","@"],["name","gt"],["empty","         "],["comment","NB. by commutativity of +"]],[["name","s1"],["empty"," "],["copula","=:"],["empty"," "],["verb","+"],["empty","    "],["paren","("],["integer","_4"],["conjunction","&"],["verb","*"],["verb","+"],["name","up"],["verb","+"],["name","dn"],["verb","+"],["name","lf"],["verb","+"],["name","rt"],["paren",")"],["conjunction","@"],["paren","("],["integer","3"],["conjunction","&"],["verb","<"],["paren",")"],["empty","    "],["comment","NB. inline cn and gt"]],[["empty",[]]],[["name","s0"],["empty"," "],["copula","=:"],["empty"," "],["verb","+"],["empty"," "],["verb","+"],["adverb","\/"],["conjunction","@"],["paren","("],["integer","_4"],["conjunction","&"],["verb","*"],["verb",","],["verb","f"],["verb",","],["verb","f"],["conjunction","&."],["paren","("],["verb","|:"],["conjunction","\""],["integer","2"],["paren",")"],["paren",")"],["conjunction","@"],["paren","("],["integer","3"],["conjunction","&"],["verb","<"],["paren",")"],["empty","    "],["comment","NB. for comparison"]],[["empty",[]]]],
[[["special","u"],["empty"," "],["copula","=:"],["empty"," "],["name","up"],["verb",",:"],["name","dn"],["empty","                          "],["comment","NB. same as f"]],[["special","v"],["empty"," "],["copula","=:"],["empty"," "],["name","lf"],["verb",",:"],["name","rt"],["empty","                          "],["comment","NB. same as f&.(|:\"2)"]],[["name","s1"],["empty"," "],["copula","=:"],["empty"," "],["verb","+"],["empty"," "],["verb","+"],["adverb","\/"],["conjunction","@"],["paren","("],["integer","_4"],["conjunction","&"],["verb","*"],["verb",","],["special","u"],["verb",","],["special","v"],["paren",")"],["conjunction","@"],["paren","("],["integer","3"],["conjunction","&"],["verb","<"],["paren",")"],["empty","          "],["comment","NB. we need to insert + between them"]],[["empty",[]]],[["paren","("],["verb","s"],["empty"," "],["verb","-:"],["empty"," "],["name","s1"],["conjunction","^:"],["floating","_"],["paren",")"],["empty"," "],["integer","50 50"],["empty"," "],["verb","$"],["empty"," "],["integer","4"],["empty","               "],["comment","NB. result 1 means the two have the same output."]]],
[[["special","u"],["empty"," "],["copula","=:"],["empty"," "],["name","up"],["verb",",:"],["name","dn"],["empty","                           "],["comment","NB. same as f"]],[["name","s1"],["empty"," "],["copula","=:"],["empty"," "],["verb","+"],["empty"," "],["verb","+"],["adverb","\/"],["conjunction","@"],["paren","("],["integer","_4"],["conjunction","&"],["verb","*"],["verb",","],["special","u"],["verb",","],["special","u"],["conjunction","&."],["paren","("],["verb","|:"],["conjunction","\""],["integer","2"],["paren",")"],["paren",")"],["conjunction","@"],["paren","("],["integer","3"],["conjunction","&"],["verb","<"],["paren",")"],["empty","   "],["comment","NB. we need to insert + between them"]],[["paren","("],["verb","s"],["empty"," "],["verb","-:"],["empty"," "],["name","s1"],["conjunction","^:"],["floating","_"],["paren",")"],["empty"," "],["integer","50 50"],["empty"," "],["verb","$"],["empty"," "],["integer","4"],["empty","                "],["comment","NB. result 1 means the two have the same output."]]],
[[["name","up"],["empty"," "],["copula","=:"],["empty"," "],["name","monad"],["empty"," "],["conjunction",":"],["empty"," "],["literal","'}.   y ,  0 '"]],[["name","dn"],["empty"," "],["copula","=:"],["empty"," "],["name","monad"],["empty"," "],["conjunction",":"],["empty"," "],["literal","'}:    0 ,  y'"]],[["special","u"],["empty"," "],["copula","=:"],["empty"," "],["name","up"],["verb",",:"],["name","dn"]],[["name","s0"],["empty"," "],["copula","=:"],["empty"," "],["verb","+"],["empty"," "],["verb","+"],["adverb","\/"],["conjunction","@"],["paren","("],["integer","_4"],["conjunction","&"],["verb","*"],["verb",","],["verb","f"],["verb",","],["verb","f"],["conjunction","&."],["paren","("],["verb","|:"],["conjunction","\""],["integer","2"],["paren",")"],["paren",")"],["conjunction","@"],["paren","("],["integer","3"],["conjunction","&"],["verb","<"],["paren",")"]],[["empty",[]]],[["verb","f"],["empty"," "],["copula","=:"],["empty"," "],["integer","_1 1"],["empty"," "],["verb","|."],["conjunction","!."],["boolean","0"],["conjunction","\""],["floating","0 _"],["empty"," "],["verb","]"]],[["name","s1"],["empty"," "],["copula","=:"],["empty"," "],["verb","+"],["empty"," "],["verb","+"],["adverb","\/"],["conjunction","@"],["paren","("],["integer","_4"],["conjunction","&"],["verb","*"],["verb",","],["special","u"],["verb",","],["special","u"],["conjunction","&."],["paren","("],["verb","|:"],["conjunction","\""],["integer","2"],["paren",")"],["paren",")"],["conjunction","@"],["paren","("],["integer","3"],["conjunction","&"],["verb","<"],["paren",")"]]],
[],
[[["name","up"],["empty"," "],["copula","=:"],["empty"," "],["name","monad"],["empty"," "],["conjunction",":"],["empty"," "],["literal","'}.     y ,  0 '"]],[["name","dn"],["empty"," "],["copula","=:"],["empty"," "],["name","monad"],["empty"," "],["conjunction",":"],["empty"," "],["literal","'}:     0 ,  y'"]],[["name","lf"],["empty"," "],["copula","=:"],["empty"," "],["name","monad"],["empty"," "],["conjunction",":"],["empty"," "],["literal","'}.\"1   y ,. 0 '"]],[["name","rt"],["empty"," "],["copula","=:"],["empty"," "],["name","monad"],["empty"," "],["conjunction",":"],["empty"," "],["literal","'}:\"1 ] 0 ,. y'"]]],
[[["name","up"],["empty"," "],["copula","=:"],["empty"," "],["name","monad"],["empty"," "],["conjunction",":"],["empty"," "],["literal","'}.\"_   y ,  0 '"]],[["name","dn"],["empty"," "],["copula","=:"],["empty"," "],["name","monad"],["empty"," "],["conjunction",":"],["empty"," "],["literal","'}:\"_ ] 0 ,  y'"]],[["name","lf"],["empty"," "],["copula","=:"],["empty"," "],["name","monad"],["empty"," "],["conjunction",":"],["empty"," "],["literal","'}.\"1   y ,. 0 '"]],[["name","rt"],["empty"," "],["copula","=:"],["empty"," "],["name","monad"],["empty"," "],["conjunction",":"],["empty"," "],["literal","'}:\"1 ] 0 ,. y'"]]],
[[["verb","o"],["empty"," "],["copula","=:"],["empty"," "],["boolean","0"]],[["name","up"],["empty"," "],["copula","=:"],["empty"," "],["name","monad"],["empty"," "],["conjunction",":"],["empty"," "],["literal","'}.\"_  y ,\"_  o'"]],[["name","lf"],["empty"," "],["copula","=:"],["empty"," "],["name","monad"],["empty"," "],["conjunction",":"],["empty"," "],["literal","'}.\"1  y ,\"1  o'"]],[["empty",[]]],[["name","dn"],["empty"," "],["copula","=:"],["empty"," "],["name","monad"],["empty"," "],["conjunction",":"],["empty"," "],["literal","'}:\"_  o ,\"_  y'"]],[["name","rt"],["empty"," "],["copula","=:"],["empty"," "],["name","monad"],["empty"," "],["conjunction",":"],["empty"," "],["literal","'}:\"1  o ,\"1  y'"]]],
[[["empty","   "],["special","m"],["empty"," "],["copula","=:"],["empty"," "],["integer","5 5"],["empty"," "],["verb","$"],["empty"," "],["floating","_"]],[["empty","   "],["special","m"]],[["floating","_ _ _ _ _"]],[["floating","_ _ _ _ _"]],[["floating","_ _ _ _ _"]],[["floating","_ _ _ _ _"]],[["floating","_ _ _ _ _"]],[["empty","   "],["paren","("],["name","up"],["verb",";"],["name","dn"],["verb",";"],["name","lf"],["verb",";"],["name","rt"],["paren",")"],["empty"," "],["special","m"]],[["invalid","\u00e2"],["invalid","\u0094"],["invalid","\u008c"],["invalid","\u00e2"],["invalid","\u0094"],["invalid","\u0080"],["invalid","\u00e2"],["invalid","\u0094"],["invalid","\u0080"],["invalid","\u00e2"],["invalid","\u0094"],["invalid","\u0080"],["invalid","\u00e2"],["invalid","\u0094"],["invalid","\u0080"],["invalid","\u00e2"],["invalid","\u0094"],["invalid","\u0080"],["invalid","\u00e2"],["invalid","\u0094"],["invalid","\u0080"],["invalid","\u00e2"],["invalid","\u0094"],["invalid","\u0080"],["invalid","\u00e2"],["invalid","\u0094"],["invalid","\u0080"],["invalid","\u00e2"],["invalid","\u0094"],["invalid","\u0080"],["invalid","\u00e2"],["invalid","\u0094"],["invalid","\u00ac"],["invalid","\u00e2"],["invalid","\u0094"],["invalid","\u0080"],["invalid","\u00e2"],["invalid","\u0094"],["invalid","\u0080"],["invalid","\u00e2"],["invalid","\u0094"],["invalid","\u0080"],["invalid","\u00e2"],["invalid","\u0094"],["invalid","\u0080"],["invalid","\u00e2"],["invalid","\u0094"],["invalid","\u0080"],["invalid","\u00e2"],["invalid","\u0094"],["invalid","\u0080"],["invalid","\u00e2"],["invalid","\u0094"],["invalid","\u0080"],["invalid","\u00e2"],["invalid","\u0094"],["invalid","\u0080"],["invalid","\u00e2"],["invalid","\u0094"],["invalid","\u0080"],["invalid","\u00e2"],["invalid","\u0094"],["invalid","\u00ac"],["invalid","\u00e2"],["invalid","\u0094"],["invalid","\u0080"],["invalid","\u00e2"],["invalid","\u0094"],["invalid","\u0080"],["invalid","\u00e2"],["invalid","\u0094"],["invalid","\u0080"],["invalid","\u00e2"],["invalid","\u0094"],["invalid","\u0080"],["invalid","\u00e2"],["invalid","\u0094"],["invalid","\u0080"],["invalid","\u00e2"],["invalid","\u0094"],["invalid","\u0080"],["invalid","\u00e2"],["invalid","\u0094"],["invalid","\u0080"],["invalid","\u00e2"],["invalid","\u0094"],["invalid","\u0080"],["invalid","\u00e2"],["invalid","\u0094"],["invalid","\u0080"],["invalid","\u00e2"],["invalid","\u0094"],["invalid","\u00ac"],["invalid","\u00e2"],["invalid","\u0094"],["invalid","\u0080"],["invalid","\u00e2"],["invalid","\u0094"],["invalid","\u0080"],["invalid","\u00e2"],["invalid","\u0094"],["invalid","\u0080"],["invalid","\u00e2"],["invalid","\u0094"],["invalid","\u0080"],["invalid","\u00e2"],["invalid","\u0094"],["invalid","\u0080"],["invalid","\u00e2"],["invalid","\u0094"],["invalid","\u0080"],["invalid","\u00e2"],["invalid","\u0094"],["invalid","\u0080"],["invalid","\u00e2"],["invalid","\u0094"],["invalid","\u0080"],["invalid","\u00e2"],["invalid","\u0094"],["invalid","\u0080"],["invalid","\u00e2"],["invalid","\u0094"],["invalid","\u0090"]],[["invalid","\u00e2"],["invalid","\u0094"],["invalid","\u0082"],["floating","_ _ _ _ _"],["invalid","\u00e2"],["invalid","\u0094"],["invalid","\u0082"],["boolean","0 0 0 0 0"],["invalid","\u00e2"],["invalid","\u0094"],["invalid","\u0082"],["floating","_ _ _ _ 0"],["invalid","\u00e2"],["invalid","\u0094"],["invalid","\u0082"],["floating","0 _ _ _ _"],["invalid","\u00e2"],["invalid","\u0094"],["invalid","\u0082"]],[["invalid","\u00e2"],["invalid","\u0094"],["invalid","\u0082"],["floating","_ _ _ _ _"],["invalid","\u00e2"],["invalid","\u0094"],["invalid","\u0082"],["floating","_ _ _ _ _"],["invalid","\u00e2"],["invalid","\u0094"],["invalid","\u0082"],["floating","_ _ _ _ 0"],["invalid","\u00e2"],["invalid","\u0094"],["invalid","\u0082"],["floating","0 _ _ _ _"],["invalid","\u00e2"],["invalid","\u0094"],["invalid","\u0082"]],[["invalid","\u00e2"],["invalid","\u0094"],["invalid","\u0082"],["floating","_ _ _ _ _"],["invalid","\u00e2"],["invalid","\u0094"],["invalid","\u0082"],["floating","_ _ _ _ _"],["invalid","\u00e2"],["invalid","\u0094"],["invalid","\u0082"],["floating","_ _ _ _ 0"],["invalid","\u00e2"],["invalid","\u0094"],["invalid","\u0082"],["floating","0 _ _ _ _"],["invalid","\u00e2"],["invalid","\u0094"],["invalid","\u0082"]],[["invalid","\u00e2"],["invalid","\u0094"],["invalid","\u0082"],["floating","_ _ _ _ _"],["invalid","\u00e2"],["invalid","\u0094"],["invalid","\u0082"],["floating","_ _ _ _ _"],["invalid","\u00e2"],["invalid","\u0094"],["invalid","\u0082"],["floating","_ _ _ _ 0"],["invalid","\u00e2"],["invalid","\u0094"],["invalid","\u0082"],["floating","0 _ _ _ _"],["invalid","\u00e2"],["invalid","\u0094"],["invalid","\u0082"]],[["invalid","\u00e2"],["invalid","\u0094"],["invalid","\u0082"],["boolean","0 0 0 0 0"],["invalid","\u00e2"],["invalid","\u0094"],["invalid","\u0082"],["floating","_ _ _ _ _"],["invalid","\u00e2"],["invalid","\u0094"],["invalid","\u0082"],["floating","_ _ _ _ 0"],["invalid","\u00e2"],["invalid","\u0094"],["invalid","\u0082"],["floating","0 _ _ _ _"],["invalid","\u00e2"],["invalid","\u0094"],["invalid","\u0082"]],[["invalid","\u00e2"],["invalid","\u0094"],["invalid","\u0094"],["invalid","\u00e2"],["invalid","\u0094"],["invalid","\u0080"],["invalid","\u00e2"],["invalid","\u0094"],["invalid","\u0080"],["invalid","\u00e2"],["invalid","\u0094"],["invalid","\u0080"],["invalid","\u00e2"],["invalid","\u0094"],["invalid","\u0080"],["invalid","\u00e2"],["invalid","\u0094"],["invalid","\u0080"],["invalid","\u00e2"],["invalid","\u0094"],["invalid","\u0080"],["invalid","\u00e2"],["invalid","\u0094"],["invalid","\u0080"],["invalid","\u00e2"],["invalid","\u0094"],["invalid","\u0080"],["invalid","\u00e2"],["invalid","\u0094"],["invalid","\u0080"],["invalid","\u00e2"],["invalid","\u0094"],["invalid","\u00b4"],["invalid","\u00e2"],["invalid","\u0094"],["invalid","\u0080"],["invalid","\u00e2"],["invalid","\u0094"],["invalid","\u0080"],["invalid","\u00e2"],["invalid","\u0094"],["invalid","\u0080"],["invalid","\u00e2"],["invalid","\u0094"],["invalid","\u0080"],["invalid","\u00e2"],["invalid","\u0094"],["invalid","\u0080"],["invalid","\u00e2"],["invalid","\u0094"],["invalid","\u0080"],["invalid","\u00e2"],["invalid","\u0094"],["invalid","\u0080"],["invalid","\u00e2"],["invalid","\u0094"],["invalid","\u0080"],["invalid","\u00e2"],["invalid","\u0094"],["invalid","\u0080"],["invalid","\u00e2"],["invalid","\u0094"],["invalid","\u00b4"],["invalid","\u00e2"],["invalid","\u0094"],["invalid","\u0080"],["invalid","\u00e2"],["invalid","\u0094"],["invalid","\u0080"],["invalid","\u00e2"],["invalid","\u0094"],["invalid","\u0080"],["invalid","\u00e2"],["invalid","\u0094"],["invalid","\u0080"],["invalid","\u00e2"],["invalid","\u0094"],["invalid","\u0080"],["invalid","\u00e2"],["invalid","\u0094"],["invalid","\u0080"],["invalid","\u00e2"],["invalid","\u0094"],["invalid","\u0080"],["invalid","\u00e2"],["invalid","\u0094"],["invalid","\u0080"],["invalid","\u00e2"],["invalid","\u0094"],["invalid","\u0080"],["invalid","\u00e2"],["invalid","\u0094"],["invalid","\u00b4"],["invalid","\u00e2"],["invalid","\u0094"],["invalid","\u0080"],["invalid","\u00e2"],["invalid","\u0094"],["invalid","\u0080"],["invalid","\u00e2"],["invalid","\u0094"],["invalid","\u0080"],["invalid","\u00e2"],["invalid","\u0094"],["invalid","\u0080"],["invalid","\u00e2"],["invalid","\u0094"],["invalid","\u0080"],["invalid","\u00e2"],["invalid","\u0094"],["invalid","\u0080"],["invalid","\u00e2"],["invalid","\u0094"],["invalid","\u0080"],["invalid","\u00e2"],["invalid","\u0094"],["invalid","\u0080"],["invalid","\u00e2"],["invalid","\u0094"],["invalid","\u0080"],["invalid","\u00e2"],["invalid","\u0094"],["invalid","\u0098"]]],
[[["name","up"],["empty"," "],["copula","=:"],["empty"," "],["name","monad"],["empty"," "],["conjunction",":"],["empty"," "],["literal","'}.     y ,  0 '"]],[["name","dn"],["empty"," "],["copula","=:"],["empty"," "],["name","monad"],["empty"," "],["conjunction",":"],["empty"," "],["literal","'}:     0 ,  y'"]],[["name","lf"],["empty"," "],["copula","=:"],["empty"," "],["name","monad"],["empty"," "],["conjunction",":"],["empty"," "],["literal","'}.\"1   y ,. 0 '"]],[["name","rt"],["empty"," "],["copula","=:"],["empty"," "],["name","monad"],["empty"," "],["conjunction",":"],["empty"," "],["literal","'}:\"1 ] 0 ,. y'"]]],
[[["name","up"],["empty"," "],["copula","=:"],["empty"," "],["name","monad"],["empty"," "],["conjunction",":"],["empty"," "],["literal","'}. y , 0'"]],[["name","dn"],["empty"," "],["copula","=:"],["empty"," "],["name","monad"],["empty"," "],["conjunction",":"],["empty"," "],["literal","'}: 0 , y'"]],[["name","lf"],["empty"," "],["copula","=:"],["empty"," "],["name","up"],["conjunction","\""],["boolean","1"]],[["name","rt"],["empty"," "],["copula","=:"],["empty"," "],["name","dn"],["conjunction","\""],["boolean","1"]],[["empty",[]]],[["special","u"],["empty"," "],["copula","=:"],["empty"," "],["name","up"],["verb",",:"],["name","dn"]],[["special","v"],["empty"," "],["copula","=:"],["empty"," "],["name","lf"],["verb",",:"],["name","rt"],["empty","        "],["comment","NB. this still works"]],[["special","v"],["empty"," "],["copula","=:"],["empty"," "],["name","up"],["conjunction","\""],["boolean","1"],["verb",",:"],["name","rt"],["conjunction","\""],["boolean","1"],["empty","    "],["comment","NB. or this, but not (v =: u\"1)"]]],
[[["special","u"],["empty"," "],["copula","=:"],["empty"," "],["name","up"],["verb",",:"],["name","dn"]],[["special","v"],["empty"," "],["copula","=:"],["empty","  "],["verb","|:"],["conjunction","&"],["name","up"],["conjunction","&"],["verb","|:"],["empty","  "],["verb",",:"],["empty","  "],["verb","|:"],["conjunction","&"],["name","dn"],["conjunction","&"],["verb","|:"],["empty","        "],["comment","NB. transpose each side before and after"]],[["special","v"],["empty"," "],["copula","=:"],["empty"," "],["paren","("],["verb","|:"],["conjunction","&"],["name","up"],["empty","     "],["verb",",:"],["empty","  "],["verb","|:"],["conjunction","&"],["name","dn"],["paren",")"],["conjunction","&"],["verb","|:"],["empty","       "],["comment","NB. we can factor out the \"before\" part"]],[["special","v"],["empty"," "],["copula","=:"],["empty"," "],["paren","("],["verb","|:"],["conjunction","\""],["integer","2"],["paren",")"],["conjunction","&"],["paren","("],["empty"," "],["name","up"],["empty"," "],["verb",",:"],["empty"," "],["name","dn"],["empty"," "],["paren",")"],["conjunction","&"],["verb","|:"],["empty","         "],["comment","NB. to factor out \"after\", we have to apply at rank 2 because it's now rank 3"]],[["special","v"],["empty"," "],["copula","=:"],["empty"," "],["paren","("],["verb","|:"],["conjunction","\""],["integer","2"],["paren",")"],["conjunction","&"],["paren","("],["name","up"],["verb",",:"],["name","dn"],["paren",")"],["conjunction","&"],["paren","("],["verb","|:"],["conjunction","\""],["integer","2"],["paren",")"],["empty","         "],["comment","NB. it's safe to put rank 2 on the \"before\" part. now the before and after are the same."]],[["special","v"],["empty"," "],["copula","=:"],["empty"," "],["paren","("],["name","up"],["verb",",:"],["name","dn"],["paren",")"],["conjunction","&."],["paren","("],["verb","|:"],["conjunction","\""],["integer","2"],["paren",")"],["empty","               "],["comment","NB. now we can use \"under\""]],[["special","v"],["empty"," "],["copula","=:"],["empty"," "],["special","u"],["conjunction","&."],["paren","("],["verb","|:"],["conjunction","\""],["integer","2"],["paren",")"]],[["empty",[]]],[["name","s1"],["empty"," "],["copula","=:"],["empty"," "],["verb","+"],["empty"," "],["verb","+"],["adverb","\/"],["conjunction","@"],["paren","("],["integer","_4"],["conjunction","&"],["verb","*"],["verb",","],["special","u"],["verb",","],["special","v"],["paren",")"],["conjunction","@"],["paren","("],["integer","3"],["conjunction","&"],["verb","<"],["paren",")"]],[["name","viewmat"],["empty"," "],["name","s1"],["conjunction","^:"],["floating","_"],["empty"," "],["verb","]"],["empty"," "],["integer","50 50"],["empty"," "],["verb","$"],["empty"," "],["integer","4"]]],
[[["name","s1"],["empty"," "],["copula","=:"],["empty"," "],["verb","+"],["empty"," "],["verb","+"],["adverb","\/"],["conjunction","@"],["paren","("],["integer","_4"],["conjunction","&"],["verb","*"],["verb",","],["special","u"],["verb",","],["special","u"],["conjunction","&."],["paren","("],["verb","|:"],["conjunction","\""],["integer","2"],["paren",")"],["paren",")"],["conjunction","@"],["paren","("],["integer","3"],["conjunction","&"],["verb","<"],["paren",")"]]],
[[["name","up"],["empty"," "],["copula","=:"],["empty"," "],["name","monad"],["empty"," "],["conjunction",":"],["empty"," "],["literal","'}. y , 0'"]],[["name","dn"],["empty"," "],["copula","=:"],["empty"," "],["name","monad"],["empty"," "],["conjunction",":"],["empty"," "],["literal","'}: 0 , y'"]],[["special","u"],["empty"," "],["copula","=:"],["empty"," "],["name","up"],["verb",",:"],["name","dn"]],[["empty",[]]],[["verb","f"],["empty"," "],["copula","=:"],["empty"," "],["integer","_1 1"],["empty"," "],["verb","|."],["conjunction","!."],["boolean","0"],["conjunction","\""],["floating","0 _"],["empty"," "],["verb","]"]],[["empty",[]]],[["name","s1"],["empty"," "],["copula","=:"],["empty"," "],["verb","+"],["empty"," "],["verb","+"],["adverb","\/"],["conjunction","@"],["paren","("],["integer","_4"],["conjunction","&"],["verb","*"],["verb",","],["special","u"],["verb",","],["special","u"],["conjunction","&."],["paren","("],["verb","|:"],["conjunction","\""],["integer","2"],["paren",")"],["paren",")"],["conjunction","@"],["paren","("],["integer","3"],["conjunction","&"],["verb","<"],["paren",")"]],[["name","s0"],["empty"," "],["copula","=:"],["empty"," "],["verb","+"],["empty"," "],["verb","+"],["adverb","\/"],["conjunction","@"],["paren","("],["integer","_4"],["conjunction","&"],["verb","*"],["verb",","],["verb","f"],["verb",","],["verb","f"],["conjunction","&."],["paren","("],["verb","|:"],["conjunction","\""],["integer","2"],["paren",")"],["paren",")"],["conjunction","@"],["paren","("],["integer","3"],["conjunction","&"],["verb","<"],["paren",")"]],[["empty",[]]],[["paren","("],["verb","s"],["empty"," "],["verb","-:"],["empty"," "],["name","s1"],["conjunction","^:"],["floating","_"],["paren",")"],["empty"," "],["integer","50 50"],["empty"," "],["verb","$"],["empty"," "],["integer","4"]]],
[[["empty","   "],["verb","i."],["empty"," "],["integer","3 3"]],[["integer","0 1 2"]],[["integer","3 4 5"]],[["integer","6 7 8"]],[["empty",[]]],[["empty","   "],["boolean","1"],["empty"," "],["verb","|."],["empty"," "],["verb","i."],["empty"," "],["integer","3 3"]],[["integer","3 4 5"]],[["integer","6 7 8"]],[["integer","0 1 2"]],[["empty",[]]],[["empty","   "],["integer","_1"],["empty"," "],["verb","|."],["empty"," "],["verb","i."],["empty"," "],["integer","3 3"]],[["integer","6 7 8"]],[["integer","0 1 2"]],[["integer","3 4 5"]]],
[[["empty","   "],["boolean","1"],["empty"," "],["verb","|."],["conjunction","!."],["floating","_"],["empty"," "],["verb","i."],["empty"," "],["integer","3 3"]],[["integer","3 4 5"]],[["integer","6 7 8"]],[["floating","_ _ _"]]],
[[["name","up"],["empty"," "],["copula","=:"],["empty"," "],["name","monad"],["empty"," "],["conjunction",":"],["empty"," "],["literal","'}. y , 0'"]],[["name","dn"],["empty"," "],["copula","=:"],["empty"," "],["name","monad"],["empty"," "],["conjunction",":"],["empty"," "],["literal","'}: 0 , y'"]],[["empty",[]]],[["name","up"],["empty"," "],["copula","=:"],["empty"," "],["name","monad"],["empty"," "],["conjunction",":"],["empty"," "],["literal","' 1 |.!.0 y'"]],[["name","dn"],["empty"," "],["copula","=:"],["empty"," "],["name","monad"],["empty"," "],["conjunction",":"],["empty"," "],["literal","'_1 |.!.0 y'"]]],
[[["name","up"],["empty"," "],["copula","=:"],["empty","  "],["boolean","1"],["empty"," "],["verb","|."],["conjunction","!."],["boolean","0"],["empty"," "],["verb","]"]],[["name","dn"],["empty"," "],["copula","=:"],["empty"," "],["integer","_1"],["empty"," "],["verb","|."],["conjunction","!."],["boolean","0"],["empty"," "],["verb","]"]],[["special","u"],["empty"," "],["copula","=:"],["empty"," "],["name","up"],["verb",",:"],["name","dn"]]],
[[["empty","   "],["verb","|."],["adverb","b."],["boolean","0"]],[["floating","_ 1 _"]]],
[[["special","u"],["empty"," "],["copula","=:"],["empty"," "],["integer","1 _1"],["empty"," "],["verb","|."],["conjunction","!."],["boolean","0"],["conjunction","\""],["floating","0 _"],["empty"," "],["verb","]"]],[["verb","f"],["empty"," "],["copula","=:"],["empty"," "],["integer","_1 1"],["empty"," "],["verb","|."],["conjunction","!."],["boolean","0"],["conjunction","\""],["floating","0 _"],["empty"," "],["verb","]"]]],
[[["name","jw"],["copula","=:"],["paren","("],["verb","+"],["verb","[:"],["paren","("],["integer","_4"],["conjunction","&"],["verb","*"],["verb","+"],["verb","[:"],["verb","+"],["adverb","\/"],["paren","("],["paren","("],["verb",","],["verb","-"],["paren",")"],["paren","("],["verb",",:"],["verb","|."],["paren",")"],["boolean","0 1"],["paren",")"],["verb","|."],["conjunction","!."],["boolean","0"],["verb","]"],["paren",")"],["integer","3"],["conjunction","&"],["verb","<"],["paren",")"],["conjunction","^:"],["floating","_"],["empty","     "],["comment","NB. jitwit's version"]],[["paren","("],["verb","s"],["empty"," "],["verb","-:"],["empty"," "],["name","jw"],["paren",")"],["empty"," "],["integer","5 5"],["empty"," "],["verb","$"],["empty"," "],["integer","4"]]],
[[["name","sj"],["empty"," "],["copula","=:"],["paren","("],["verb","+"],["empty"," "],["verb","[:"],["empty"," "],["paren","("],["integer","_4"],["conjunction","&"],["verb","*"],["verb","+"],["verb","[:"],["verb","+"],["adverb","\/"],["paren","("],["paren","("],["verb",","],["verb","-"],["paren",")"],["paren","("],["verb",",:"],["verb","|."],["paren",")"],["boolean","0 1"],["paren",")"],["verb","|."],["conjunction","!."],["boolean","0"],["verb","]"],["paren",")"],["empty"," "],["integer","3"],["conjunction","&"],["verb","<"],["paren",")"],["empty","     "],["comment","NB. remove the ^:_"]],[["empty",[]]],[["name","sj"],["empty"," "],["copula","=:"],["empty"," "],["verb","+"],["empty"," "],["verb","[:"],["empty"," "],["paren","("],["integer","_4"],["conjunction","&"],["verb","*"],["verb","+"],["verb","[:"],["verb","+"],["adverb","\/"],["paren","("],["paren","("],["verb",","],["verb","-"],["paren",")"],["paren","("],["verb",",:"],["verb","|."],["paren",")"],["boolean","0 1"],["paren",")"],["verb","|."],["conjunction","!."],["boolean","0"],["verb","]"],["paren",")"],["empty"," "],["integer","3"],["conjunction","&"],["verb","<"],["empty","      "],["comment","NB. drop parens"]],[["comment","NB.   _ __ ________________________________ ___    4 verbs"]],[["comment","NB.   _ ___________________________   2 verbs"]],[["name","s0"],["empty"," "],["copula","=:"],["empty"," "],["verb","+"],["empty"," "],["verb","+"],["adverb","\/"],["conjunction","@"],["paren","("],["integer","_4"],["conjunction","&"],["verb","*"],["verb",","],["verb","f"],["verb",","],["verb","f"],["conjunction","&."],["paren","("],["verb","|:"],["conjunction","\""],["integer","2"],["paren",")"],["paren",")"],["conjunction","@"],["paren","("],["integer","3"],["conjunction","&"],["verb","<"],["paren",")"]]],
[],
[[["name","up"],["empty"," "],["copula","=:"],["empty","  "],["boolean","1"],["empty"," "],["verb","|."],["conjunction","!."],["boolean","0"],["empty"," "],["verb","]"]],[["name","dn"],["empty"," "],["copula","=:"],["empty"," "],["integer","_1"],["empty"," "],["verb","|."],["conjunction","!."],["boolean","0"],["empty"," "],["verb","]"]],[["special","u"],["empty"," "],["copula","=:"],["empty"," "],["name","up"],["verb",",:"],["name","dn"]]],
[[["name","up"],["empty"," "],["copula","=:"],["empty","  "],["boolean","1 0"],["empty"," "],["verb","|."],["conjunction","!."],["boolean","0"],["empty"," "],["verb","]"]],[["name","dn"],["empty"," "],["copula","=:"],["empty"," "],["integer","_1 0"],["empty"," "],["verb","|."],["conjunction","!."],["boolean","0"],["empty"," "],["verb","]"]],[["name","lf"],["empty"," "],["copula","=:"],["empty","  "],["boolean","0 1"],["empty"," "],["verb","|."],["conjunction","!."],["boolean","0"],["empty"," "],["verb","]"]],[["name","rt"],["empty"," "],["copula","=:"],["empty","  "],["integer","0 _1"],["verb","|."],["conjunction","!."],["boolean","0"],["empty"," "],["verb","]"]],[["special","u"],["empty"," "],["copula","=:"],["empty"," "],["name","up"],["verb",",:"],["name","dn"]],[["special","v"],["empty"," "],["copula","=:"],["empty"," "],["name","lf"],["verb",",:"],["name","rt"]]],
[[["verb","g"],["empty"," "],["copula","=:"],["empty"," "],["special","u"],["verb",","],["special","v"]],[["verb","g"],["empty"," "],["copula","=:"],["empty"," "],["paren","("],["boolean","1 0"],["verb",","],["empty"," "],["integer","_1 0"],["verb",","],["empty"," "],["boolean","0 1"],["verb",",:"],["empty"," "],["integer","0 _1"],["paren",")"],["empty"," "],["verb","|."],["conjunction","!."],["boolean","0"],["empty"," "],["verb","]"]],[["name","s1"],["empty"," "],["copula","=:"],["empty"," "],["verb","+"],["verb","+"],["adverb","\/"],["conjunction","@"],["paren","("],["integer","_4"],["conjunction","&"],["verb","*"],["verb",","],["verb","g"],["paren",")"],["conjunction","@"],["paren","("],["integer","3"],["conjunction","&"],["verb","<"],["paren",")"]],[["paren","("],["verb","s"],["empty"," "],["verb","-:"],["empty"," "],["name","s1"],["conjunction","^:"],["floating","_"],["paren",")"],["empty"," "],["integer","5 5"],["empty"," "],["verb","$"],["empty"," "],["integer","4"]]],
[[["special","n"],["empty"," "],["copula","=:"],["empty"," "],["integer","4 2"],["verb","$"],["integer","0 1 1 0 0 _1 _1 0"]],[["special","n"],["empty"," "],["copula","=:"],["empty"," "],["boolean","0 1"],["verb",","],["empty"," "],["boolean","1 0"],["verb",","],["empty"," "],["integer","0 _1"],["verb",",:"],["empty"," "],["integer","_1 0"]],[["special","n"],["empty"," "],["copula","=:"],["empty"," "],["paren","("],["verb",","],["verb","-"],["paren",")"],["paren","("],["verb",",:"],["verb","|."],["paren",")"],["boolean","0 1"]]],
[[["name","jw"],["empty"," "],["copula","=:"],["empty"," "],["verb","+"],["verb","[:"],["paren","("],["integer","_4"],["conjunction","&"],["verb","*"],["verb","+"],["verb","[:"],["verb","+"],["adverb","\/"],["special","n"],["verb","|."],["conjunction","!."],["boolean","0"],["verb","]"],["paren",")"],["integer","3"],["conjunction","&"],["verb","<"]],[["name","s1"],["empty"," "],["copula","=:"],["empty"," "],["verb","+"],["verb","+"],["adverb","\/"],["conjunction","@"],["paren","("],["integer","_4"],["conjunction","&"],["verb","*"],["verb",","],["special","n"],["verb","|."],["conjunction","!."],["boolean","0"],["verb","]"],["paren",")"],["conjunction","@"],["paren","("],["integer","3"],["conjunction","&"],["verb","<"],["paren",")"],["empty","   "],["comment","NB. (f g@h)  <-->  (f[:g h)"]],[["name","s1"],["empty"," "],["copula","=:"],["empty"," "],["verb","+"],["verb","[:"],["verb","+"],["adverb","\/"],["conjunction","@"],["paren","("],["integer","_4"],["conjunction","&"],["verb","*"],["verb",","],["special","n"],["verb","|."],["conjunction","!."],["boolean","0"],["verb","]"],["paren",")"],["integer","3"],["conjunction","&"],["verb","<"],["empty","    "],["comment","NB. shaves off one character by swapping [: for @()"]],[["paren","("],["verb","s"],["empty"," "],["verb","-:"],["empty"," "],["name","s1"],["conjunction","^:"],["floating","_"],["paren",")"],["empty"," "],["integer","5 5"],["empty"," "],["verb","$"],["empty"," "],["integer","4"]]],
[[["special","n"],["empty"," "],["copula","=:"],["empty"," "],["paren","("],["verb",","],["verb","-"],["paren",")"],["paren","("],["verb",",:"],["verb","|."],["paren",")"],["boolean","0 1"]],[["special","n"],["empty"," "],["copula","=:"],["empty"," "],["paren","("],["verb",","],["verb","-"],["paren",")"],["verb","="],["adverb","\/"],["adverb","~"],["verb","i."],["integer","2"]],[["special","n"],["empty"," "],["copula","=:"],["empty"," "],["paren","("],["verb",","],["verb","-"],["paren",")"],["integer","2"],["verb","]"],["adverb","\\"],["verb","i:"],["boolean","1"]]],
[[["name","s1"],["empty"," "],["copula","=:"],["empty"," "],["verb","+"],["verb","[:"],["verb","+"],["adverb","\/"],["conjunction","@"],["paren","("],["integer","_4"],["conjunction","&"],["verb","*"],["verb",","],["paren","("],["paren","("],["verb",","],["verb","-"],["paren",")"],["integer","2"],["verb","]"],["adverb","\\"],["verb","i:"],["boolean","1"],["paren",")"],["verb","|."],["conjunction","!."],["boolean","0"],["verb","]"],["paren",")"],["integer","3"],["conjunction","&"],["verb","<"]]],
[[["name","load"],["empty"," "],["literal","'viewmat'"]],[["verb","d"],["empty"," "],["copula","=:"],["empty"," "],["boolean","0 1"],["verb",","],["empty"," "],["boolean","1 0"],["verb",","],["empty"," "],["integer","0 _1"],["verb",",:"],["empty"," "],["integer","_1 0"],["empty","          "],["comment","NB. directions to shift"]],[["verb","s"],["empty"," "],["copula","=:"],["empty"," "],["verb","+"],["empty"," "],["verb","[:"],["empty"," "],["verb","+"],["adverb","\/"],["conjunction","@"],["paren","("],["integer","_4"],["conjunction","&"],["verb","*"],["verb",","],["empty"," "],["verb","d"],["verb","|."],["conjunction","!."],["boolean","0"],["verb","]"],["paren",")"],["empty"," "],["integer","3"],["conjunction","&"],["verb","<"],["empty","    "],["comment","NB. sandpiles step"]],[["name","viewmat"],["empty"," "],["verb","s"],["conjunction","^:"],["floating","_"],["empty"," "],["verb","["],["empty"," "],["integer","50 50"],["empty"," "],["verb","$"],["empty"," "],["integer","4"]]],
    ]

  slide = i => data['src']=slides[i].slice()
  slide(1)

  let ints = i => { let r = []; for (let j=0;j<i;j++) r.push(j); return r }
  let str = tok => tok[1]
  let typ = toks => toks.map(t=>t[0])
  let txt = toks => toks.map(t=>t[1])
  let line = toks => toks.map(str).join('')
  let ins = (a,i,x)=> a.slice(0,i).concat(x).concat(a.slice(i))
  function exmo(li, nm) {  // li: line of tokens,  nm: variable name
    let sp = 5  // start position
    let ep = -2 // end position -- strip trailing ws and comma ( TODO: fix this )
    let re = RegExp("\\b" + nm + "\\b") // only match name when it's a complete word
    let mo = ("'" + txt(li.slice(sp,ep)).join('') + "'").replace(re, 'y')  // extracted monad as string
    let ws = ['empty', ' '] // whitespace (one space char)
    return li.slice(0,sp).concat([['noun','monad'],ws,['conjunction',':'],ws,['literal', mo],ws,['name',nm], ws]);
  }



  // ---- scratch ---------------------------------


  // sample animation with web animation api
  //let h1 = document.getElementsByTagName('h1')[0]
  //let an = h1.animate({color:'red'},{duration: 1000, fill:'forwards'})
  //an.commitStyles()
  //an.persist()

  // animations from the web animation api only provide transformations of
  // individual numeric or color attributes. They do not allow modifying the
  // dom in arbitrary ways, such as changing an element's text or re-grouping
  // elements.
  //
  // Since we want to do these things in our animations, we need an extended
  // language that allows arbitrary behaviors.
  //
  // My animations are structures (js classes) with three functions on {dt, t},
  // where t is a "timestamp" (a number between 0 and 1), and dt is the change
  // in t since the last rendered frame.
  //
  class Animation {
    t0(dt) {}     // called when t=0
    t1(dt) {}     // called when t=1
    ts(dt, t) {}} // called on every other step of the animation.

  // We'll assume that time can move in either direction by any amount.
  // From a UI perspective, imagine a single horizontal timeline with a
  // cursor that can be dragged (or "scrubbed") left and right with the mouse.
  //
  // Shorter timelines can be nested inside longer timelines. (From the
  // UI perspective, these would probably show up as separate horizontal
  // lines beneath the main timeline, something like a Gantt chart.
  //
  // Each timeline treats time as an interval between 0 and 1, and the
  // top-level t and dt variables are scaled and shifted appropriately
  // when calling functions for the nested timelines. Likewise, dt is
  // truncated to the range -1 ... 1, so that scrubbing past one end or
  // the other of the timeline never results in large values being passed
  // to t0 or t1.

  class TSpan {  // time span
    constructor(t0, dur) {
      self.t0  = t0;   // start time
      self.dur = dur; // duration
    }
  }

  // constructor(dur) { self.dur = dur; } // duration, in ms

  class ASeq extends Animation {
    // sequence several animations one after another.
    constructor(seq) {
      super(sum(seq.map(a => a.dur)));
      this.seq = seq; }
    t0(dt) { this.seq[0].t0(dt) }
    ts(dt,t) { }
    t1(dt) { this.seq[this.seq.length-1].t1(dt) }
  }

  class TEvent { // 0-duration timeline event
    fwd() { }    // run the event fwd
    bkw() { }}   // undo the event


  // extract monad as single timeline event
  class ExMoEvt extends TEvent {
    constructor(i, nm) { super(); this.i = i; this.nm = nm }
    fwd() {
      var lines = slides[1]
      Vue.set(data.src, this.i, exmo(lines[this.i], this.nm)) }
  }


  function run() {
    let evts = ints(5).map(i => i+2).map(i => new ExMoEvt(i, 'gt'))
    evts.forEach(e => e.fwd()) }


</script>
</html>
